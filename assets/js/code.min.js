$(document).ready(e=>{if((new WOW).init(),window.location.href.includes("?")&&window.history.replaceState(null,"",window.location.href.split("?")[0]),null!=sessionStorage.getItem("CartSession")?$.ajax({url:"/Carts/idCart/"+sessionStorage.getItem("CartSession"),type:"GET",success:function(e,t){"nocontent"!==t?$("#carrito_badge").text(parseInt(e)):$("#carrito_badge").text("0")}}).fail(function(e,t,o){0!==e.status&&500!=e.status||($("#carrito_badge").text("0"),console.log("Error 500 fallo el servidor",o))}):$("#carrito_badge").text("0"),null!==localStorage.getItem("userSession")){null!=JSON.parse(localStorage.getItem("userSession")).token&&(document.getElementById("btnAdmin").style.display="block"),document.getElementById("btnLogin").style.display="none",document.getElementById("btnLogout").style.display="block",new Date>new Date(JSON.parse(localStorage.getItem("userSession")).expire)&&logout()}else document.getElementById("btnLogin").style.display="block",document.getElementById("btnLogout").style.display="none"});var IMAGES,CATALOG_ROLE,firebaseConfig={apiKey:"AIzaSyB1LKzSELcOuXiHRhdxY2fXecKyaRotM6Y",authDomain:"codens-18ad2.firebaseapp.com",databaseURL:"https://codens-18ad2.firebaseio.com",projectId:"codens-18ad2",storageBucket:"codens-18ad2.appspot.com",messagingSenderId:"311440713794",appId:"1:311440713794:web:07f8926444234a20"};function logout(){document.getElementById("btnLogout").style.display="none",document.getElementById("btnLogin").style.display="block",document.getElementById("btnAdmin").style.display="none",localStorage.removeItem("userSession"),window.location.href="/"}function adminClick(e){null!==localStorage.getItem("userSession")&&(parent.location=`/Admin/${e}?token=${JSON.parse(localStorage.getItem("userSession")).token}`)}function openModal(e){document.getElementById("botom-modal-body").innerText=e.body_text;let t=document.getElementById("btn-cancel-modal"),o=document.getElementById("btn-accept-modal"),a=document.getElementById("btn-close-modal"),n=document.getElementById("bottom-modal-content");null!=e.operation&&("Success"===e.operation?n.classList.add("content_modal_success"):n.classList.add("content_modal_failed"),t.style.display="none",o.style.display="none",a.style.display="block",a.classList.add("fadeIn")),$("#botom-modal").hasClass("show")||$("#botom-modal").modal("toggle"),$("#botom-modal").on("hidden.bs.modal",function(e){a.classList.remove("fadeIn"),t.style.display="block",o.style.display="block",a.style.display="none",n.classList.remove("content_modal_failed"),n.classList.remove("content_modal_success")})}function initProductModule(){$(document).ready(function(){const e=firebase.storage().ref();var t="";if(t=null!==document.getElementById("product-holder")?"Edit":"Add",console.log(t),"Edit"===t){var o=JSON.parse($("#product-holder").attr("value"));fillProductForm(o.response),console.log(o.response)}else IMAGES=[void 0,void 0,void 0,void 0,void 0,void 0];$("#btnAction").click(function(){openModal({body_text:"Seguro que quieres guardar los moviemientos de este producto?"})}),$("#bestseller_btn").click(function(){setBtnBestSeller()}),$("#btn-accept-modal").click(o=>{var a=[];$("#botom-modal-row").append('<div id="loader" class="lds-facebook mr-5"><div></div><div></div><div></div></div>');let n=0,d=0;IMAGES.forEach(e=>{null!=e&&d++}),console.log(d),IMAGES.forEach(o=>{if(null!=o)if("string"!=typeof o){e.child(o.name).put(o).then(i=>{e.child(o.name).getDownloadURL().then(e=>{a.push(e.substring(0,e.indexOf("?"))),++n===d&&saveProduct(a,t)})})}else a.push(o),++n===d&&saveProduct(a,t)})})}),document.getElementById("input").addEventListener("change",handleFiles,!1)}function cleanProductForm(){var e=document.getElementById("input");e.value="",$("#images").empty(),console.log(e.files),IMAGES=[void 0,void 0,void 0,void 0,void 0,void 0],document.getElementById("name").value="",document.getElementById("description").value="",document.getElementById("category").value="",document.getElementById("state").value="",document.getElementById("currentPrice").value="",document.getElementById("originalPrice").value="",document.getElementById("availableStock").value="",document.getElementById("aditionalInfo").value="",console.log(IMAGES),console.log($("#images")),console.log(e)}function fillProductForm(e){IMAGES=[void 0,void 0,void 0,void 0,void 0,void 0],!0===e.bestSeller?$("#bestseller_btn").data("seleccionado","NO"):$("#bestseller_btn").data("seleccionado","SI"),setBtnBestSeller(),document.getElementById("name").value=e.name,$("#name-label").addClass("active"),document.getElementById("description").value=e.description,$("#description-label").addClass("active"),document.getElementById("category").value=e.category,document.getElementById("state").value=e.state,document.getElementById("currentPrice").value=e.currentPrice,$("#currentPrice-label").addClass("active"),document.getElementById("originalPrice").value=e.originalPrice,$("#originalPrice-label").addClass("active"),document.getElementById("availableStock").value=e.availableStock,$("#availableStock-label").addClass("active"),document.getElementById("aditionalInfo").value=e.aditionalInfo,$("#aditionalInfo-label").addClass("active");for(let t=0;t<e.images.length;t++){let o=e.images[t].split("/"),a="";o.forEach(e=>{e.includes("?alt=media")&&(a=e.substring(0,e.indexOf("?alt=media"))).length>15&&(a=a.substring(0,10)+a.substring(a.length-5,a.length))}),$("#images").append('<a id="'+t+'" onclick="deleteImage(this, true)" class="background-btn btn btn-outline-white waves-effect waves-light" target="_blank" role="button">'+a+"</a>"),$("#"+t).hover(e=>{$("#"+t).text("Eliminar Imagen")},e=>{$("#"+t).text(a)}),IMAGES[t]=e.images[t]}}function saveProduct(e,t){var o=document.getElementById("name").value,a=[];e.forEach(e=>{e.includes("?alt=media")?a.push(e):a.push(e+="?alt=media")});var n="NO";"Edit"===t&&(n=$("#bestseller_btn").data("seleccionado"));var d=document.getElementById("description").value,i=document.getElementById("category").value,s=document.getElementById("state").value,l=document.getElementById("currentPrice").value,r=document.getElementById("originalPrice").value,c="availableStock="+document.getElementById("availableStock").value+"&name="+o+"&description="+d+"&category="+i+"&state="+s+"&currentPrice="+l+"&originalPrice="+r+"&aditionalInfo="+document.getElementById("aditionalInfo").value+"&images="+a+"&bestSeller="+n;let u,p;"Edit"===t?(u=`/Products/Update/${window.location.href.split("/")[window.location.href.split("/").length-1]}`,p="PUT"):(u="/Products/Save",p="POST"),$.ajax({url:u,type:p,data:c,success:function(e,o){openModal("nocontent"!==o?{body_text:"Se modifico el producto con exito!.",operation:"Success"}:{body_text:"No modifico el producto, intentalo de nuevo.",operation:"Failed"}),$("#loader").remove(),$("#btn-close-modal").click(e=>{"Add"===t&&cleanProductForm(),window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(function(){document.getElementById("name").focus()},750)})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion con el servidor.",operation:"Failed"})})}function deleteImage(e,t){$("#images").append('<div id="loader" class="lds-facebook ml-5"><div></div><div></div><div></div></div>'),t?(console.log("esta en la base de datos"),ref.child(IMAGES[e.id].split("/")[7].split("?")[0]).delete().then(function(){IMAGES[e.id]=void 0,$("#"+e.id).remove(),$("#loader").remove()}).catch(function(t){console.log("Algo malo paso"+t),IMAGES[e.id]=void 0,$("#"+e.id).remove(),$("#loader").remove()})):(IMAGES[e.id]=void 0,$("#"+e.id).remove("hide"),$("#loader").remove())}function setBtnBestSeller(){"NO"==$("#bestseller_btn").data("seleccionado")?($("#bestseller_btn").text("SI"),$("#bestseller_btn").data("seleccionado","SI"),$("#bestseller_btn").removeClass("btn-secondary"),$("#bestseller_btn").addClass("btn-primary")):($("#bestseller_btn").data("seleccionado","NO"),$("#bestseller_btn").text("NO"),$("#bestseller_btn").removeClass("btn-primary"),$("#bestseller_btn").addClass("btn-secondary"))}function handleFiles(){for(let e=0;e<6;e++){if(null==IMAGES[e]){IMAGES[e]=this.files[0],$("#images").append('<a id="'+e+'" onclick="deleteImage(this, false)" class="background-btn btn btn-outline-white waves-effect waves-light" target="_blank" role="button">'+IMAGES[e].name+"</a>"),$("#"+e).hover(t=>{$("#"+e).text("Eliminar Imagen")},t=>{$("#"+e).text(IMAGES[e].name)});break}5==e&&alert("Ya eligiste el maximo de images, elimina una antes de intentar subir otra")}}function initProductDetails(e){console.log(e),$("#btnAddCart").click(t=>{var o=parseInt($("#currentQuantity").text());console.log("cantidadDisponible: "+o+"  Cantidad Seleccionada: "+$("#quantity_form").val()),o<$("#quantity_form").val()||0==o||0==$("#quantity_form").val()?openModal({body_text:"La cantidad que elegiste excede al stock que se tiene del producto!.",operation:"Failed"}):null==sessionStorage.getItem("CartSession")?$.ajax({url:"/Carts/Generate",type:"GET",success:function(t,o){var a=JSON.parse(t);"NotFound"===a.status?(sessionStorage.setItem("CartSession",a.response),addOrder(e)):openModal({body_text:"No se pudo generar el identificador del carrito, intentalo mas tarde!.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})}):addOrder(e)})}function addOrder(e){$.ajax({url:"/Orders/Save",type:"POST",data:{idCart:sessionStorage.getItem("CartSession"),idProduct:e.id,quantity:Number($("#quantity_form").val()),unitaryPrice:e.currentPrice,completed:!1},success:function(e,t){"nocontent"!==t?($("#carrito_badge").text(parseInt($("#carrito_badge").text())+1),$("#currentQuantity").text(parseInt($("#currentQuantity").text())-$("#quantity_form").val()),openModal({body_text:"Se agrego el pedido con exito!.",operation:"Success"})):openModal({body_text:"Ocurrio un problema al guardar el pedido!, por favor intenta de nuevo.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function initCatalogModule(e){setCatalogRole(e),getAllCatalogProducts(),$("#btn-accept-modal").click(e=>{deleteProduct(sessionStorage.getItem("deletedProductId"))})}function setCatalogRole(e){CATALOG_ROLE=e}function deleteProduct(e){const t=firebase.storage().ref();$.ajax({url:"/Products/Delete/"+e,type:"DELETE",success:function(o,a){if("nocontent"!==a){let a=0;o.images.forEach(e=>{t.child(e.split("/")[7].split("?")[0]).delete().then(function(){++a===o.images.length&&console.log("se eliminaron todas")}).catch(function(e){console.error(e)})}),openModal({body_text:"Se elimino el producto satisfactoriamente!.",operation:"Success"}),$("#prod_"+e).remove()}else openModal({body_text:"No se pudo puede eliminar, por que tiene pedidos pendientes!.",operation:"Failed"})}}),sessionStorage.removeItem("deletedProductId")}function showDeleteModal(e){openModal({body_text:"Deseas eliminar este producto del sistema?"}),sessionStorage.setItem("deletedProductId",e)}function getAllCatalogProducts(){setCatalogSelectedOption(""),$.ajax({url:"/Products/GetAll",type:"GET",success:function(e,t){"nocontent"!==t?setCatalogProducts(e.response):openModal({body_text:"No se encontraron productos en el sistema!.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function searchProduct(e){""==$("#search_input").val()?(getAllCatalogProducts(),console.log("ENTRO AQUI")):$.ajax({url:"/Products/Search/"+$("#search_input").val(),type:"GET",success:function(e,t){setCatalogProducts(e.response)}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function getProductsByCategory(e){$.ajax({url:"/Products/Category/"+e,type:"GET",success:function(t,o){console.log(t),"nocontent"!==o?(setCatalogSelectedOption(e),setCatalogProducts(t.response),$("#frameModalBottom").modal("toggle")):openModal({body_text:`No se encontraron producto en el area de ${e}!.`,operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function setCatalogSelectedOption(e){for(let e=0;e<6;e++)$("#btn_opcion_"+(e+1)).hasClass("active")&&$("#btn_opcion_"+(e+1)).removeClass("active");switch(e){case"":$("#btn_opcion_1").addClass("active");break;case"Ropa":$("#btn_opcion_2").addClass("active");break;case"Calzado":$("#btn_opcion_3").addClass("active");break;case"Electronicos":$("#btn_opcion_4").addClass("active");break;case"Electrodomesticos":$("#btn_opcion_5").addClass("active");break;case"Varios":$("#btn_opcion_6").addClass("active")}}function setCatalogProducts(e){var t=["","fast","slow","slower"];try{let o;$("#products").empty();let a=-1,n=!0;for(let d=0;d<e.length;d++){0===d&&(o='<div class="row wow fadeIn w-100" id="prod_'+e[d]._id+'">'),d%4==0&&d>0&&(o+="</div>",o+='<div class="row wow fadeIn w-100" id="prod_'+e[d]._id+'">',0!==a&&(a++,n=!n)),n?a++:a--;let i="animated bounceInUp "+t[a];"User"===CATALOG_ROLE?(o+='<div class="'+i+' col-lg-3 col-md-3 mb-4"><div class="card"><div class="view overlay"><img src="'+e[d].images[0]+'" class="card-img-top" alt="">',o+='<a href="/Producto/id/'+e[d]._id+'"><div class="mask rgba-white-slight"></div></a></div><div class="card-body text-center">',o+='<a class="grey-text"><h5>'+e[d].category+'</h5></a><h5><strong><a href="/Producto/id/'+e[d]._id+'" class="dark-grey-text">'+e[d].name+'<span class="badge badge-pill danger-color">'+e[d].state+"</span>",o+='</a></strong></h5><h4 class="font-weight-bold red-text PrecioOriginal"><strong>'+e[d].originalPrice+'$</strong></h4><h4 class="font-weight-bold blue-text">',o+="<strong>"+e[d].currentPrice+"$</strong></h4></div></div></div>"):(o+='<div class="'+i+' col-lg-3 col-md-3 mb-4"><div class="card"><div class="view overlay"><img id="img-'+e[d]._id+'" src="'+e[d].images[0]+'" class="card-img-top" alt=""><a href="/Producto/id/'+e[d]._id+'">',o+='<div class="mask rgba-white-slight"></div></a></div><div class="card-body text-center"><a class="grey-text"><h5>'+e[d].category+'</h5></a><h5><strong><a href="/Producto/id/'+e[d]._id+'" class="dark-grey-text">',o+=e[d].name+'<span class="mx-2 badge badge-pill danger-color">'+e[d].state+'</span></a></strong></h5><div class="row"><div class="col-md-6"><button id="btnEditar" onclick="parent.location=\'/ModificarProducto/id/'+e[d]._id+'\'" class="btn btn-primary btn-md btn-block mx-auto px-0"',o+=`type="button">Editar</button></div><div class="col-md-6"><button onclick="showDeleteModal('${e[d]._id}')" class="btn btn-primary btn-md btn-block mx-auto px-0" style="background-color: tomato!important;" type="button">`,o+="Eliminar</button></div></div></div></div></div>")}$("#products").append(o)}catch(e){}}function initOrderDetails(e){getCart(e)}function initOrdersList(){null!==localStorage.getItem("userSession")&&getCartsIdsFromUser(0,6),$("#btnSearchCart").click(e=>{$("#pedidos-container").empty(),getInfoFromCart($("#IdCart").val())})}function getCartsIdsFromUser(e,t){$.ajax({url:`/Carts/Get/From/${e}/To/${t}/User/`+JSON.parse(localStorage.getItem("userSession")).idUser,type:"GET",success:function(e,t){if(console.log(e),"nocontent"!==t){$("#pedidos-container").empty(),setPaginationActions(e.cartsLength,6,"User");let t=0;e.carts.forEach(o=>{getInfoFromCart(o._id).done(o=>{if(++t===e.carts.length){null!==document.getElementById("content").attributes.getNamedItem("hidden")&&document.getElementById("content").attributes.removeNamedItem("hidden");for(let t=0;t<e.carts.length;t++)t%2==0?document.getElementById(`pedido_${e.carts[t]._id}`).classList.add("slideInLeft"):document.getElementById(`pedido_${e.carts[t]._id}`).classList.add("slideInRight"),setTimeout(o=>{document.getElementById(`pedido_${e.carts[t]._id}`).classList.remove("slideInRight"),document.getElementById(`pedido_${e.carts[t]._id}`).classList.remove("slideInLeft")},1e3)}})})}else $("#spacer-div").removeAttr("hidden"),$("#content").attr("hidden","true"),openModal({body_text:"No se han realizado pedidos aun!.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function getInfoFromCart(e){return $.ajax({url:"/Carts/id/"+e,type:"GET",success:function(t,o){if(console.log(t),"nocontent"!==o){let o="";t.sent&&(o="COLOCADO"),t.payed&&(o="PAGADO"),t.delivered&&(o="ENVIADO"),t.completed&&(o="COMPLETADO");let a="/Pedidos/id/",n=`<div class="col-12 col-md-5 mx-2 my-2 animated" id="pedido_${e}"><a id="pedido_item_${t._id}" onclick="parent.location='${a}${t._id}'" data-toggle="collapse" class="shadow list-group-item list-group-item-action d-flex justify-content-between align-items-center">`+`<div class="flex-column w-100">Cliente: ${t.name} ${t.lastNames}<p><small>Direccion Envio: ${t.address}, ${t.address2}, ${t.cp}, Ensenada, `+`B.C.</small></p><div class="row w-100"><div class="col-6 col-md-6"><small></small><span id="estado_pedido_${e}" class="badge badge-dark badge-pill">${o}</span> <small></div><div class="col-6 col-md-6">Realizado: </small><span id="created_${t._id}" class="badge badge-dark badge-pill">${t.creationDate}</span></div></div></div> `;$("#pedidos-container").append(n),$("#spacer-div").attr("hidden","true"),$("#content").removeAttr("hidden")}else $("#spacer-div").removeAttr("hidden"),$("#content").attr("hidden","true"),openModal({body_text:"No se encontro un pedido para ese codigo!.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con la conexion al servidor, intentalo de nuevo!.",operation:"Failed"})})}function setPaginationActions(e,t,o){if(document.getElementById("pagination-links").innerHTML="",0!==e){document.getElementById("pagination").style.display="block";for(let a=0;a<e;a++)if(a%t==0){let e=a;e=0===e?1:e/t+1;let n=document.createElement("li");n.classList.add("page-item");let d=document.createElement("a");d.classList.add("page-link"),"Admin"===o?d.setAttribute("onclick",`getAdminListCarts(${a}, ${a+t})`):d.setAttribute("onclick",`getCartsIdsFromUser(${a}, ${a+t})`),d.text=e.toString(),n.appendChild(d),document.getElementById("pagination-links").append(n)}}else document.getElementById("pagination").style.display="none"}function searchCart(e){""==$("#IdCart").val()&&getCartsIdsFromUser(0,6)}function getCart(e){console.log(e),$.ajax({url:"/Carts/GetOrders/Cart/"+e,type:"GET",success:function(t,o){if(console.log(t),"nocontent"!==o){$.ajax({url:"/Carts/id/"+e,type:"GET",success:function(e,t){if("nocontent"!==t){let t=e.name+" "+e.lastNames;t+=", en la direccion "+e.address+", "+e.address2+", "+e.cp+", Ensenada, B.C",$("#datos_envio").text(t),e.sent&&$("#estado_actual").text("COLOCADO"),e.payed&&$("#estado_actual").text("PAGADO"),e.delivered&&$("#estado_actual").text("ENVIADO"),e.completed&&$("#estado_actual").text("COMPLETADO")}}}),$("#pedidos_elements").empty();var a=0;t.forEach(e=>{$.ajax({url:"/Orders/id/"+e.id_order,type:"GET",success:function(t,o){console.log(t),"nocontent"!==o?(a+=e.product.currentPrice*t.quantity,console.log(e.product),elemento='<li class="list-group-item d-flex justify-content-between lh-condensed">',elemento+=`<div class="container"><div class="row text-center"><div class="col-4 col-md-4"><div><h6 class="my-0">${e.product.name}</h6><small class="text-muted">Cantidad: x${t.quantity}</small></div></div>`,elemento+=`<div class="col-5 col-md-5"><small class="text-muted">${e.product.description}</small></div><div class="col-3 col-md-3"><span class="text-muted">Precio Unitario: $${e.product.currentPrice}</span></div></li></div>`,$("#pedidos_elements").append($(elemento)),$("#total_precio").text("$"+a)):openModal({body_text:"Ocurrio un problema al intentar obtener el producto, por favor intenta de nuevo.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}),console.log(a),$("#cantidad_productos_pedidos").text(t.length)}else openModal({body_text:"No se encontro un pedido para ese codigo!.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}function initCheckOutModule(){null!=sessionStorage.getItem("CartSession")&&(null!=localStorage.getItem("userSession")&&fillUserInfo(JSON.parse(localStorage.getItem("userSession")).idUser),getCheckOutCart(sessionStorage.getItem("CartSession")),$("#btnCompletar").click(e=>{saveCart(sessionStorage.getItem("CartSession"))}))}function fillUserInfo(e){$.ajax({url:"/Users/id/"+e,type:"GET",success:function(e,t){if("nocontent"!==t){let t=JSON.parse(e);$("#lastName").val(t.lastNames),$("#lastName").focus(),$("#firstName").val(t.name),$("#firstName").focus(),$("#email").val(t.email),$("#address").val(t.address),$("#zip").val(t.cp)}}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}function saveCart(e){let t="Invitado";null!=localStorage.getItem("userSession")&&(t=JSON.parse(localStorage.getItem("userSession")).idUser),$.ajax({url:"/Carts/Save",type:"POST",data:{id:e,idUser:t,name:$("#firstName").val(),lastNames:$("#lastName").val(),email:$("#email").val(),address:$("#address").val(),address2:$("#address-2").val(),cp:$("#zip").val()},success:function(e,t){"nocontent"!==t?(openModal({body_text:"Se agrego el pedido con exito.",operation:"Success"}),$("#botom-modal").on("hidden.bs.modal",function(){sessionStorage.clear(),window.location="/"})):openModal({body_text:"Hubo un problema al agregar el pedido, intenta de nuevo mas tarde.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}function getCheckOutCart(e){$.ajax({url:"/Carts/GetOrders/Cart/"+e,type:"GET",success:function(e,t){if("nocontent"!==t){let t=0;console.log(e),e.forEach(o=>{t+=o.product.currentPrice,element='<li id="element'+e.indexOf(o)+'" class="list-group-item d-flex justify-content-between lh-condensed">',element+='<div><h6 id="nombre'+e.indexOf(o)+'" class="my-0">'+o.product.name+'</h6><small id="descripcion'+e.indexOf(o)+'" class="text-muted">',element+=o.product.description+'</small></div><span><button id="btn_cancelar'+e.indexOf(o)+'" style="background-color: tomato!important;opacity: 0" class="btn btn-secondary btn-md waves-effect m-0 w-100"  type="button">Cancelar</button></span><span id="precio'+e.indexOf(o)+'" class="text-muted">$'+o.product.currentPrice+"</span></li>",$(element).insertBefore("#promo_code")}),$("#total_precio").text("$"+t),$("#cantidad_products_pedidos").text(e.length),$("#spacer-div").attr("hidden","true"),$("#content").removeAttr("hidden"),$("#content").css("display","none"),$("#content").fadeIn(1e3)}else openModal({body_text:"Hubo un problema con el pedido, intenta de nuevo mas tarde.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}function initCartModule(){null!=sessionStorage.getItem("CartSession")?getCartOrders(sessionStorage.getItem("CartSession")):($("#spacer-div").removeAttr("hidden"),$("#content").attr("hidden","true"))}function getCartOrders(e){console.log(e),$.ajax({url:"/Carts/GetOrders/Cart/"+e,type:"GET",success:function(e,t){if("nocontent"!==t){console.log(e),$("#pedidos_elements").empty();let t=0;e.forEach(o=>{t+=o.product.currentPrice,element='<li id="element'+e.indexOf(o)+'" class="list-group-item d-flex justify-content-between lh-condensed">',element+='<div><h6 id="nombre'+e.indexOf(o)+'" class="my-0">'+o.product.name+'</h6><small id="descripcion'+e.indexOf(o)+'" class="text-muted">',element+=o.product.description+'</small></div><span><button id="btn_cancelar'+e.indexOf(o)+'" style="background-color: tomato!important;opacity: 0" class="btn btn-secondary btn-md waves-effect m-0 w-100"  type="button">Cancelar</button></span><span id="precio'+e.indexOf(o)+'" class="text-muted">$'+o.product.currentPrice+"</span></li>",$("#pedidos_elements").append(element),$("#element"+e.indexOf(o)).hover(t=>{$("#element"+e.indexOf(o)).removeClass("paint-out"),$("#nombre"+e.indexOf(o)).removeClass("paint-out"),$("#precio"+e.indexOf(o)).removeClass("paint-out"),$("#descripcion"+e.indexOf(o)).removeClass("paint-out"),$("#btn_cancelar"+e.indexOf(o)).removeClass("fade-out"),$("#element"+e.indexOf(o)).addClass("paint-in"),$("#nombre"+e.indexOf(o)).addClass("paint-in"),$("#precio"+e.indexOf(o)).addClass("paint-in"),$("#precio"+e.indexOf(o)).removeClass("text-muted"),$("#descripcion"+e.indexOf(o)).addClass("paint-in"),$("#descripcion"+e.indexOf(o)).removeClass("text-muted"),$("#btn_cancelar"+e.indexOf(o)).addClass("fade-in")},t=>{$("#element"+e.indexOf(o)).removeClass("paint-in"),$("#nombre"+e.indexOf(o)).removeClass("paint-in"),$("#precio"+e.indexOf(o)).removeClass("paint-in"),$("#descripcion"+e.indexOf(o)).removeClass("paint-in"),$("#btn_cancelar"+e.indexOf(o)).removeClass("fade-in"),$("#element"+e.indexOf(o)).addClass("paint-out"),$("#nombre"+e.indexOf(o)).addClass("paint-out"),$("#precio"+e.indexOf(o)).addClass("paint-out"),$("#precio"+e.indexOf(o)).addClass("text-muted"),$("#descripcion"+e.indexOf(o)).addClass("paint-out"),$("#descripcion"+e.indexOf(o)).addClass("text-muted"),$("#btn_cancelar"+e.indexOf(o)).addClass("fade-out")}),$("#btn_cancelar"+e.indexOf(o)).click(function(){$.ajax({url:"/Orders/Delete/"+o.id_order,type:"DELETE",success:function(t,a){"nocontent"!==a?($("#total_precio").text("$"+(parseFloat($("#total_precio").text().split("$")[1])-o.product.currentPrice)),$("#cantidad_products_pedidos").text(parseInt($("#cantidad_products_pedidos").text())-1),$("#element"+e.indexOf(o)).remove()):openModal({body_text:"Hubo un problema al eliminar el pedido, intenta de nuevo mas tarde.",operation:"Failed"})}})})}),$("#total_precio").text("$"+t),$("#cantidad_products_pedidos").text(e.length),$("#spacer-div").attr("hidden","true"),$("#content").removeAttr("hidden"),$("#content").css("display","none"),$("#content").fadeIn(1e3)}else $("#spacer-div").removeAttr("hidden"),$("#content").attr("hidden","true"),$("#spacer-div").css("display","none"),$("#spacer-div").fadeIn(1e3)}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}firebase.initializeApp(firebaseConfig);var operation={operation:"",id:""};function initAdminOrdersModule(){$("#btn-accept-modal").click(e=>{"marcar_como"===operation.operation&&$.ajax({url:"/Carts/Update/"+operation.id,type:"PUT",data:{state:$("#botom-modal-body").text().split(":")[1]},success:function(e,t){"nocontent"!==t?($("#estado_pedido_"+operation.id).text($("#botom-modal-body").text().split(":")[1]),console.log($("#estado_pedido_"+operation.id).text()),"COMPLETADO"===$("#botom-modal-body").text().split(":")[1]?$("#col-btn-marcar").remove():$("#btnMarcar"+operation.id).text("MARCAR COMO "+getNextState(getCurrentOrderStateFromText($("#botom-modal-body").text().split(":")[1]))),console.log("llego aqio"),openModal({body_text:"Se actualizo el pedido con exito.",operation:"Success"})):openModal({body_text:"Hubo un problema al modificar el pedido, intenta de nuevo mas tarde.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})}),"cancelar"===operation.operation&&$.ajax({url:"/Carts/Delete/"+operation.id,type:"DELETE",success:function(e,t){"nocontent"!==t?($("#pedido_item_"+operation.id).fadeOut(1e3,function(){$("#pedido_item_"+operation.id).remove()}),$("#collapsePedido"+operation.id).fadeOut(1e3,function(){$("#collapsePedido"+operation.id).remove()}),openModal({body_text:"Se elimino el pedido con exito.",operation:"Success"})):openModal({body_text:"No se pudo modificar el pedido.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}),getAdminListCarts(0,4)}function getAdminListCarts(e,t){$.ajax({url:`/Carts/Get/From/${e}/To/${t}/User/undefined`,type:"GET",success:function(e,t){"nocontent"!==t?(console.log(e),setPaginationActions(e.cartsLength,4,"Admin"),$("#pedidos_list").empty(),$("#pedidos_elements").empty(),e.carts.forEach(e=>{let t=`<a id="pedido_item_${e._id}" data-toggle="collapse" href="#collapsePedido${e._id}" class="animated fast slideInLeft shadow list-group-item list-group-item-action d-flex justify-content-between align-items-center mt-2">`+'<div class="flex-column">Cliente: '+e.name+" "+e.lastNames+"<p><small>Direccion Envio: "+e.address+", "+e.address2+", "+e.cp+', Ensenada, B.C.</small></p><span id="estado_pedido_'+e._id+'" class="mx-2 badge badge-warning badge-pill">'+getOrderState(e)+'</span><span id="fecha_pedido_'+e._id+'" class="mx-2 badge badge-warning badge-pill">Realizado: '+e.creationDate+"</span></div>",o='<div class="collapse" id="collapsePedido'+e._id+'"><div class="card card-body"><ul class="list-group list-group-horizontal">',a=0;$.ajax({url:"/Orders/All/idCart/"+e._id,type:"GET",success:function(n,d){"nocontent"!==d?n.forEach(d=>{$.ajax({url:"/Products/id/"+d.idProduct,type:"GET",success:function(i,s){"nocontent"!==s?(console.log(i),a+=i.currentPrice*d.quantity,o+='<li class="list-group-item mx-2 shadow"><span>'+d.quantity.toString()+"x</span> "+i.name+'<span style="color: green;"><small> $'+d.unitaryPrice+"</small></span></li>",n.length===n.indexOf(d)+1&&(e.completed?o+='</ul><div class="row my-3"><div class="col-md-4"><button id="btnCancelar'+e._id+'" onclick="cancelOrder(this)" class="btn btn-danger btn-md btn-block" type="button">Cancelar Pedido</button></div></div></div></div>':o+='</ul><div class="row my-3"><div id="col-btn-marcar" class="col-md-4"><button id="btnMarcar'+e._id+'" onclick="markOrder(this)" class="btn btn-success btn-md btn-block" type="button">Marcar Como '+getNextState(e)+'</button></div><div class="col-md-4"><button id="btnCancelar'+e._id+'" onclick="cancelOrder(this)" class="btn btn-danger btn-md btn-block" type="button">Cancelar Pedido</button></div></div></div></div>',t+='<div class="flex-column">Total: $'+a+"</div></div></a>",$("#pedidos_list").append(t+o))):openModal({body_text:"No se pudieron obtener los pedidos, intenta recargar la pagina.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}):openModal({body_text:"No se pudieron obtener los pedidos, intenta recargar la pagina.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}),$("#spacer-div").attr("hidden","true"),$("#content").removeAttr("hidden")):($("#spacer-div").removeAttr("hidden"),$("#content").attr("hidden","true"),openModal({body_text:"No se encontro ningun pedido.",operation:"Failed"}))}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}function getOrderState(e){return e.completed?"COMPLETADO":e.delivered?"ENVIADO":e.payed?"PAGADO":"COLOCADO"}function getNextState(e){return e.sent&&!e.payed?"PAGADO":e.payed&&!e.delivered?"ENVIADO":e.delivered&&!e.completed?"COMPLETADO":void 0}function cancelOrder(e){console.log(e.id),openModal({body_text:"Seguro que quieres cancelar este pedido? Se debera realizar una devolucion del pago."}),operation.operation="cancelar",operation.id=e.id.split("btnCancelar")[1]}function getCurrentOrderStateFromText(e){let t={payed:!1,delivered:!1,completed:!1,sent:!1};switch(e){case"PAGADO":t.payed=!0;break;case"ENVIADO":t.delivered=!0;break;case"COMPLETADO":t.completed=!0;break;case"COLOCADO":t.sent=!0}return t}function markOrder(e){operation.id=e.id.split("btnMarcar")[1],console.log(operation),console.log($("#estado_pedido_"+operation.id).text()),openModal({body_text:"Seguro que quieres marcarlo como:"+getNextState(getCurrentOrderStateFromText($("#estado_pedido_"+operation.id).text()))}),operation.operation="marcar_como"}function cleanOrders(){$.ajax({url:"/Carts/Admin/Clean",type:"GET",success:function(e,t){openModal("nocontent"!==t?{body_text:"Se han eliminado todos los pedidos sin pagar.",operation:"Success"}:{body_text:"Ocurrio un problema al eliminar los pedidos, intentalo de nuevo.",operation:"Failed"})}}).fail(function(e,t,o){0!==e.status&&500!=e.status||openModal({body_text:"Hubo un problema con el servidor, intenta de nuevo mas tarde.",operation:"Failed"})})}
